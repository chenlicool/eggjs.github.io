<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>简单的 Egg 应用 | Egg</title>
    <meta name="description" content="为企业级框架和应用而生">
    <link rel="icon" href="/favicon.png" type="image/x-icon">
    
    <link rel="preload" href="/assets/css/0.styles.4659e948.css" as="style"><link rel="preload" href="/assets/js/app.77aa8c4f.js" as="script"><link rel="preload" href="/assets/js/3.dcc3f7c0.js" as="script"><link rel="preload" href="/assets/js/1.afc15f94.js" as="script"><link rel="preload" href="/assets/js/8.cf9e16b0.js" as="script"><link rel="prefetch" href="/assets/js/10.1d10814c.js"><link rel="prefetch" href="/assets/js/11.5abde44a.js"><link rel="prefetch" href="/assets/js/12.2889c771.js"><link rel="prefetch" href="/assets/js/13.5756d463.js"><link rel="prefetch" href="/assets/js/14.76791e11.js"><link rel="prefetch" href="/assets/js/15.496a396e.js"><link rel="prefetch" href="/assets/js/16.b174f96e.js"><link rel="prefetch" href="/assets/js/17.7da596f5.js"><link rel="prefetch" href="/assets/js/18.a0b1deac.js"><link rel="prefetch" href="/assets/js/19.e65fcbf6.js"><link rel="prefetch" href="/assets/js/20.a4fb7e93.js"><link rel="prefetch" href="/assets/js/21.ff93a132.js"><link rel="prefetch" href="/assets/js/22.828a3b43.js"><link rel="prefetch" href="/assets/js/23.6397e5b9.js"><link rel="prefetch" href="/assets/js/24.9be1b01e.js"><link rel="prefetch" href="/assets/js/25.32f81bbe.js"><link rel="prefetch" href="/assets/js/26.2b5d15f2.js"><link rel="prefetch" href="/assets/js/27.3f5677d2.js"><link rel="prefetch" href="/assets/js/28.29168215.js"><link rel="prefetch" href="/assets/js/29.dd5dfed9.js"><link rel="prefetch" href="/assets/js/30.b6d90030.js"><link rel="prefetch" href="/assets/js/31.1141f7ac.js"><link rel="prefetch" href="/assets/js/32.dfb8cc9e.js"><link rel="prefetch" href="/assets/js/33.0955b641.js"><link rel="prefetch" href="/assets/js/34.bdc8e075.js"><link rel="prefetch" href="/assets/js/35.eeb51878.js"><link rel="prefetch" href="/assets/js/4.3e5c2d0b.js"><link rel="prefetch" href="/assets/js/5.b83169a7.js"><link rel="prefetch" href="/assets/js/6.b736b694.js"><link rel="prefetch" href="/assets/js/7.a26c7040.js"><link rel="prefetch" href="/assets/js/9.7106307e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4659e948.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="left-logo-part"><a href="/zh/" class="home-link router-link-active"><img src="/logo.svg" alt="Egg" class="logo"> <span class="site-name can-hide">Egg</span></a> <div placeholder="在 Egg 中搜索" class="egg-search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value="" placeholder="在 Egg 中搜索"> <!----></div></div> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/" class="nav-link">首页</a></div><div class="nav-item"><a href="/zh/quickstart/" class="nav-link router-link-active">快速开始</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item dropdown-item-single"><h4><a href="/quickstart/egg.html" class="nav-link">English</a></h4> <!----></li><li class="dropdown-item dropdown-item-single"><h4><a href="/zh/quickstart/egg.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></h4> <!----></li></ul></div></div> <div class="nav-item"><a href="https://github.com/eggjs/eggjs.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></nav></div></header> <div class="sidebar-mask"></div> <aside stick="foot" class="sticker sidebar"><div class="sidebar-wrap"><nav class="nav-links"><div class="nav-item"><a href="/zh/" class="nav-link">首页</a></div><div class="nav-item"><a href="/zh/quickstart/" class="nav-link router-link-active">快速开始</a></div><div class="nav-item"><a href="/zh/guide/" class="nav-link">教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item dropdown-item-single"><h4><a href="/quickstart/egg.html" class="nav-link">English</a></h4> <!----></li><li class="dropdown-item dropdown-item-single"><h4><a href="/zh/quickstart/egg.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></h4> <!----></li></ul></div></div> <div class="nav-item"><a href="https://github.com/eggjs/eggjs.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></nav>  <ul class="sidebar-links"><li><section class="sidebar-item"><a href="/zh/quickstart/" class="sidebar-item-heading router-link-active"><!---->
    快速开始
  </a> <!----></section></li><li><section class="sidebar-item"><a href="/zh/quickstart/egg.html" class="sidebar-item-heading router-link-exact-active router-link-active"><!---->
    简单的 Egg 应用
  </a> <!----></section></li></ul> </div></aside> <main class="page"> <div class="content content__default"><h1 id="简单的-egg-应用"><a href="#简单的-egg-应用" aria-hidden="true" class="header-anchor">#</a> 简单的 Egg 应用</h1> <p>在本章中我们先来学习如何写一个简单的 <code>Egg</code> 应用，通过它来了解一些基本的概念和术语。</p> <div class="tip custom-block"><p class="custom-block-title">友情提示</p> <p>需注意的是，本文介绍的是 <code>Egg</code> 的基础使用。
对于 <code>Egg</code> 的开发者而言，很多插件无需自行安装，已经内置到框架，直接开启即可。
更多内容，在<a href="/zh/guide/">开发指南</a>中可以了解到。</p></div> <h2 id="典型场景"><a href="#典型场景" aria-hidden="true" class="header-anchor">#</a> 典型场景</h2> <p>我们以 <a href="http://todomvc.com/" target="_blank" rel="noopener noreferrer">TodoMVC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这个典型的前端应用场景为例，一步步从零开始搭建。</p> <p>完整的源码参见 <a href="https://github.com/eggjs/examples/tree/master/todomvc" target="_blank" rel="noopener noreferrer">eggjs/examples/todomvc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><a target="_blank" rel="noopener noreferrer" class="md-img-wrapper"><img src="/assets/img/todomvc.c40dbbd3.png" alt="" onload="this.parentNode.href=this.src"></a></p> <h2 id="逐步搭建"><a href="#逐步搭建" aria-hidden="true" class="header-anchor">#</a> 逐步搭建</h2> <h3 id="环境准备"><a href="#环境准备" aria-hidden="true" class="header-anchor">#</a> 环境准备</h3> <ul><li>操作系统：支持 <code>macOS</code>，<code>Linux</code>，<code>Windows</code>，推荐本地开发用 <code>macOS</code>。</li> <li>运行环境：仅需要 <a href="https://nodejs.org" target="_blank" rel="noopener noreferrer">Node.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，对应的安装参见<a href="/zh/quickstart/prepare.html">文档</a>。</li></ul> <h3 id="初始化项目"><a href="#初始化项目" aria-hidden="true" class="header-anchor">#</a> 初始化项目</h3> <p>通过骨架来<a href="/zh/workflow/development/init.html">初始化</a>：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 使用 `Egg` 的 `simple` 骨架来初始化</span>
$ <span class="token function">mkdir</span> demo <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> demo
$ <span class="token function">npm</span> init egg --type<span class="token operator">=</span>simple
$ <span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><h3 id="目录结构"><a href="#目录结构" aria-hidden="true" class="header-anchor">#</a> 目录结构</h3> <p>框架奉行『约定优于配置』，所以我们首先来看看生成的目录结构，更多可以参见<a href="/zh/guide/directory.html">目录规范</a>。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>demo
├── app
│   ├── controller <span class="token comment"># 控制器</span>
│   │   └── home.js
│   └── router.js  <span class="token comment"># 路由映射</span>
├── config <span class="token comment"># 配置文件</span>
│   ├── config.default.js
│   └── plugin.js
├── <span class="token function">test</span> <span class="token comment"># 单元测试</span>
├── README.md
└── package.json
</code></pre></div><h3 id="controller"><a href="#controller" aria-hidden="true" class="header-anchor">#</a> <code>Controller</code></h3> <p><a href="/zh/guide/controller.html">Controller</a> 负责<strong>解析用户的输入，处理后返回相应的结果</strong>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/controller/home.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Controller <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'hi, egg'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HomeController<span class="token punctuation">;</span>
</code></pre></div><p>接着配置 <a href="/zh/guide/router.html">路由</a> 映射到对应的 <code>URL</code> 上。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/router.js</span>
<span class="token comment">/**
 * @param {Egg.Application} app - egg application
 */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> router<span class="token punctuation">,</span> controller <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">;</span>
  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>home<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="本地开发"><a href="#本地开发" aria-hidden="true" class="header-anchor">#</a> 本地开发</h3> <p>框架提供了<a href="/zh/workflow/development/development.html">本地开发</a>的辅助工具。</p> <ul><li>辅助本地启动应用，监控代码变更自动重启。</li> <li>自动生成 <code>d.ts</code> 文件，提供 <code>智能提示</code> 和 <code>代码跳转</code> 等能力。</li></ul> <p>通过命令启动应用：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> run dev
</code></pre></div><p>然后就可以访问 <code>http://127.0.0.1:7001</code>。</p> <h3 id="模板渲染"><a href="#模板渲染" aria-hidden="true" class="header-anchor">#</a> 模板渲染</h3> <p>绝大多数情况，我们都需要读取数据后渲染模板，然后呈现给用户。</p> <p>但 <code>Egg</code> 并不强制你使用某种模板引擎，故我们需要引入对应的『插件』。</p> <div class="tip custom-block"><p class="custom-block-title">术语讲堂</p> <p>插件机制是我们框架的一大特色。它不但可以保证框架核心的足够精简、稳定、高效，还可以促进业务逻辑的复用，生态圈的形成。
详见<a href="/zh/guide/plugin.html">开发指南 - 插件</a>文档。</p></div> <p>在本章中，我们使用 <a href="https://mozilla.github.io/nunjucks/" target="_blank" rel="noopener noreferrer">Nunjucks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来渲染，先安装对应的插件 <a href="https://github.com/eggjs/egg-view-nunjucks" target="_blank" rel="noopener noreferrer">egg-view-nunjucks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i egg-view-nunjucks --save
</code></pre></div><p>开启插件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config/plugin.js</span>
exports<span class="token punctuation">.</span>nunjucks <span class="token operator">=</span> <span class="token punctuation">{</span>
  enable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">package</span><span class="token punctuation">:</span> <span class="token string">'egg-view-nunjucks'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>按照约定，在 <code>app/view</code> 目录下添加对应的模板文件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- app/view/home.tpl --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/public/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对应的 <code>Controller</code> 改为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">// 渲染模板 `app/view/home.tpl`</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'home.tpl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="静态资源"><a href="#静态资源" aria-hidden="true" class="header-anchor">#</a> 静态资源</h3> <p>前端代码的发布，一般有：</p> <ul><li>构建后发布到 <code>CDN</code>。（推荐）</li> <li>直接在应用中托管。</li></ul> <p><code>Egg</code> 内置了 <a href="https://github.com/eggjs/egg-static" target="_blank" rel="noopener noreferrer">egg-static<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 插件，对后者提供了支持。</p> <p>默认会把 <code>app/public</code> 目录映射到 <code>/public</code> 路由上。</p> <p>在本例中，我们使用 <code>Vue</code> 来写对应的前端逻辑，可以直接参见示例代码。</p> <div class="warning custom-block"><p class="custom-block-title">注意事项</p> <ul><li><code>static</code> 插件，线上会默认设置一年的 <code>magAge</code>。</li> <li>框架默认开启了 <a href="/zh/ecosystem/security/csrf.html">CSRF 防护</a>，故 <code>AJAX</code> 请求需要带上对应的 <code>token</code>：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/public/main.js</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'x-csrf-token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'csrfToken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <h3 id="配置文件"><a href="#配置文件" aria-hidden="true" class="header-anchor">#</a> 配置文件</h3> <p>写业务的时候，不可避免的需要有<a href="/zh/guide/config.html">配置文件</a>。</p> <p>框架提供了强大的配置合并管理功能。</p> <p>如上述的 <code>nunjucks</code> 插件，添加对应的配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config/config.default.js</span>
config<span class="token punctuation">.</span>view <span class="token operator">=</span> <span class="token punctuation">{</span>
  defaultViewEngine<span class="token punctuation">:</span> <span class="token string">'nunjucks'</span><span class="token punctuation">,</span>
  mapping<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'.tpl'</span><span class="token punctuation">:</span> <span class="token string">'nunjucks'</span><span class="token punctuation">,</span>
    <span class="token string">'.html'</span><span class="token punctuation">:</span> <span class="token string">'nunjucks'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意事项</p> <p>是 <code>config</code> 目录，不是 <code>app/config</code>!</p></div> <h3 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> <code>Service</code></h3> <p>我们的业务逻辑一般会写在 <a href="/zh/guide/service.html">Service</a> 里，然后供 <code>Controller</code> 调用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/service/todo.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Service <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TodoService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * create todo
   * @param {Todo} todo - todo info without `id`, but `title` required
   */</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">todo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// validate</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token number">422</span><span class="token punctuation">,</span> <span class="token string">'task title required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// normalize</span>
    todo<span class="token punctuation">.</span>id <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    todo<span class="token punctuation">.</span>completed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> todo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应的 <code>Controller</code> 如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/controller/todo.js</span>
<span class="token keyword">class</span> <span class="token class-name">TodoController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> service <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">// params validate, need `egg-validate` plugin</span>
    <span class="token comment">// ctx.validate({ title: { type: 'string' } });</span>

    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">201</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token keyword">await</span> service<span class="token punctuation">.</span>todo<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="restful"><a href="#restful" aria-hidden="true" class="header-anchor">#</a> <code>RESTful</code></h3> <p><code>Egg</code> 对 <code>RESTful</code> 这种常见的场景提供了<a href="/zh/guide/router.html#RESTful-风格的-URL-定义">内建的支持</a>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/router.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> router<span class="token punctuation">,</span> controller <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">;</span>

  <span class="token comment">// RESTful 映射</span>
  router<span class="token punctuation">.</span><span class="token function">resources</span><span class="token punctuation">(</span><span class="token string">'/api/todo'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>对应的 <code>Controller</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/controller/todo.js</span>
<span class="token keyword">class</span> <span class="token class-name">TodoController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token comment">// `GET /api/todo`</span>
  <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// `POST /api/todo`</span>
  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// `PUT /api/todo`</span>
  <span class="token keyword">async</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// `DELETE /api/todo`</span>
  <span class="token keyword">async</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="单元测试"><a href="#单元测试" aria-hidden="true" class="header-anchor">#</a> 单元测试</h3> <p>Web 应用中的单元测试非常重要，框架也提供了对应的<a href="/zh/workflow/development/unittest.html">单元测试能力支持</a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test/app/controller/todo.test.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> mock<span class="token punctuation">,</span> assert <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg-mock/bootstrap'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test/app/controller/todo.test.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should add todo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">httpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/todo'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'Add one'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token regex">/json/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'X-Response-Time'</span><span class="token punctuation">,</span> <span class="token regex">/\d+ms/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>body<span class="token punctuation">.</span>title <span class="token operator">===</span> <span class="token string">'Add one'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>body<span class="token punctuation">.</span>completed <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="edit-link"><a href="https://github.com/eggjs/eggjs.github.io/blob/docs/docs/zh/quickstart/egg.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div></footer> <div class="page-nav"><p class="inner"><a href="/zh/quickstart/" title="快速开始" class="prev router-link-active">
        上一篇<br><span>快速开始</span></a> <!----></p></div> </main> <div class="global-foot"><div class="friend-links"><div class="friend-list-wrapper"><div class="friend-list"><div class="friend-list-align"><div class="friend-list-title">Github</div> <a href="https://github.com/eggjs" target="_blank" class="friend-list-item">Organization</a><a href="https://github.com/eggjs/examples" target="_blank" class="friend-list-item">Example</a> <!----></div></div><div class="friend-list"><div class="friend-list-align"><div class="friend-list-title">Links</div> <a href="https://ant.design" target="_blank" class="friend-list-item">Ant Design</a><a href="http://motion.ant.design/" target="_blank" class="friend-list-item">Ant Motion</a><a href="https://antv.alipay.com/" target="_blank" class="friend-list-item">Antv</a><a href="https://umijs.org/" target="_blank" class="friend-list-item">Umi.js</a> <!----></div></div><div class="friend-list"><div class="friend-list-align"><div class="friend-list-title">Community</div> <a href="https://eggjs.org/zh-cn/faq.html" target="_blank" class="friend-list-item">FAQ</a><a href="https://www.yuque.com/egg/nodejs" target="_blank" class="friend-list-item">Node.js Column</a> <!----></div></div><div class="friend-list"><div class="friend-list-align"><div class="friend-list-title">Egg.js Dingtalk</div>  <div class="friend-qrcode"><img src="/egg/qrcode_dingtalk.png"></div></div></div></div></div> <div class="copyright"><span class="span"><span>Copyright © 2019 Egg.js</span></span></div></div> <div stick="foot" class="sticker egg-toc"><div class="egg-toc-item egg-toc-h2 active"><a href="#典型场景" title="典型场景">典型场景</a></div><div class="egg-toc-item egg-toc-h2"><a href="#逐步搭建" title="逐步搭建">逐步搭建</a></div><div class="egg-toc-item egg-toc-h3"><a href="#环境准备" title="环境准备">环境准备</a></div><div class="egg-toc-item egg-toc-h3"><a href="#初始化项目" title="初始化项目">初始化项目</a></div><div class="egg-toc-item egg-toc-h3"><a href="#目录结构" title="目录结构">目录结构</a></div><div class="egg-toc-item egg-toc-h3"><a href="#controller" title="Controller">Controller</a></div><div class="egg-toc-item egg-toc-h3"><a href="#本地开发" title="本地开发">本地开发</a></div><div class="egg-toc-item egg-toc-h3"><a href="#模板渲染" title="模板渲染">模板渲染</a></div><div class="egg-toc-item egg-toc-h3"><a href="#静态资源" title="静态资源">静态资源</a></div><div class="egg-toc-item egg-toc-h3"><a href="#配置文件" title="配置文件">配置文件</a></div><div class="egg-toc-item egg-toc-h3"><a href="#service" title="Service">Service</a></div><div class="egg-toc-item egg-toc-h3"><a href="#restful" title="RESTful">RESTful</a></div><div class="egg-toc-item egg-toc-h3"><a href="#单元测试" title="单元测试">单元测试</a></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.77aa8c4f.js" defer></script><script src="/assets/js/3.dcc3f7c0.js" defer></script><script src="/assets/js/1.afc15f94.js" defer></script><script src="/assets/js/8.cf9e16b0.js" defer></script>
  </body>
</html>
