(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{51:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"方案选型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案选型","aria-hidden":"true"}},[s._v("#")]),s._v(" 方案选型")]),s._v(" "),a("p",[s._v("配置的管理有多种方案，以下列一些常见的方案：")]),s._v(" "),a("ul",[a("li",[s._v("使用平台管理配置，应用构建时将当前环境的配置放入包内，启动时指定该配置。但应用就无法一次构建多次部署，而且本地开发环境想使用配置会变的很麻烦。")]),s._v(" "),a("li",[s._v("使用平台管理配置，在启动时将当前环境的配置通过环境变量传入，这是比较优雅的方式，但框架对运维的要求会比较高，需要部署平台支持，同时开发环境也有相同痛点。")]),s._v(" "),a("li",[s._v("使用代码管理配置，在代码中添加多个环境的配置，在启动时传入当前环境的参数即可。但无法全局配置，必须修改代码。")])]),s._v(" "),a("p",[s._v("我们选择了最后一种配置方案，"),a("strong",[s._v("配置即代码")]),s._v("，配置的变更也应该经过 Review 后才能发布。应用包本身是可以部署在多个环境的，只需要指定运行环境即可。")]),s._v(" "),a("h2",{attrs:{id:"运行环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行环境","aria-hidden":"true"}},[s._v("#")]),s._v(" 运行环境")]),s._v(" "),a("p",[s._v("Egg 应用是一次构建多地部署，所以 Egg 会根据外部传入的一些配置来决定如何运行。")]),s._v(" "),a("h3",{attrs:{id:"env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#env","aria-hidden":"true"}},[s._v("#")]),s._v(" env")]),s._v(" "),a("p",[s._v("应用开发者可以通过 "),a("code",[s._v("app.config.env")]),s._v(" 获取当前运行环境。")]),s._v(" "),a("p",[s._v("以下为框架支持的运行环境：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("serverEnv")]),s._v(" "),a("th",[s._v("NODE_ENV")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("local")]),s._v(" "),a("td",[s._v("-")]),s._v(" "),a("td",[s._v("本地开发环境")])]),s._v(" "),a("tr",[a("td",[s._v("unittest")]),s._v(" "),a("td",[s._v("test")]),s._v(" "),a("td",[s._v("单元测试环境")])]),s._v(" "),a("tr",[a("td",[s._v("prod")]),s._v(" "),a("td",[s._v("production")]),s._v(" "),a("td",[s._v("生产环境")])])])]),s._v(" "),a("p",[s._v("运行环境会决定插件是否开启，选择默认的配置项，对开发者非常友好。")]),s._v(" "),a("h2",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),a("p",[s._v("框架会根据不同的运行环境来加载不同的配置文件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("showcase\n├── app\n└── config\n    ├── config.default.js\n    ├── config.prod.js\n    ├── config.unittest.js\n    ├── config.default.js\n    └── config.local.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("config.default.js")]),s._v(" 为默认的配置文件，所有环境都会加载它，"),a("strong",[s._v("绝大部分配置应该写在这里")]),s._v("。")]),s._v(" "),a("li",[s._v("然后会根据运行环境加载对应的配置，并覆盖默认配置的同名配置。\n"),a("ul",[a("li",[s._v("如 "),a("code",[s._v("prod")]),s._v(" 环境会加载 "),a("code",[s._v("config.prod.js")]),s._v(" 和 "),a("code",[s._v("config.default.js")]),s._v(" 文件。")]),s._v(" "),a("li",[s._v("然后 "),a("code",[s._v("config.prod.js")]),s._v(" 会覆盖 "),a("code",[s._v("config.default.js")]),s._v(" 的同名配置。")])])])]),s._v(" "),a("p",[s._v("具体的运行环境与配置文件的加载规则，参见"),a("router-link",{attrs:{to:"/zh/workflow/deployment/"}},[s._v("应用部署")]),s._v("文档相关章节。")],1),s._v(" "),a("h2",{attrs:{id:"配置定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置定义","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置定义")]),s._v(" "),a("p",[s._v("配置文件返回的是一个 Object 对象，支持三种写法，请根据具体场合选择合适的写法。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// config/config.default.js")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/admin/logs/demoapp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("配置文件也可以简化的写成 "),a("code",[s._v("exports.key = value")]),s._v(" 形式。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// config/config.default.js")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'my-cookie-secret-key'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  level"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DEBUG'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("也可以是一个 "),a("code",[s._v("function")]),s._v("，入参为 "),a("code",[s._v("appInfo")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// config/config.default.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("appInfo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("appInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'logs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" appInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("友情提示")]),s._v(" "),a("p",[s._v("一些插件文档里面，描述配置时，可能会使用 "),a("code",[s._v("exports.pluginName = {}")]),s._v(" 的方式。")]),s._v(" "),a("p",[s._v("复制时，请根据你的具体配置写法进行修正。")])]),s._v(" "),a("h2",{attrs:{id:"appinfo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#appinfo","aria-hidden":"true"}},[s._v("#")]),s._v(" "),a("code",[s._v("AppInfo")])]),s._v(" "),a("p",[s._v("内置的 "),a("code",[s._v("appInfo")]),s._v(" 有：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("appInfo")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("pkg")]),s._v(" "),a("td",[s._v("package.json")])]),s._v(" "),a("tr",[a("td",[s._v("name")]),s._v(" "),a("td",[s._v("应用名，同 "),a("code",[s._v("pkg.name")]),s._v("。")])]),s._v(" "),a("tr",[a("td",[s._v("baseDir")]),s._v(" "),a("td",[s._v("应用的代码根目录。")])]),s._v(" "),a("tr",[a("td",[s._v("HOME")]),s._v(" "),a("td",[s._v("用户目录，如 "),a("code",[s._v("admin")]),s._v(" 账户为 "),a("code",[s._v("/home/admin")]),s._v("。")])]),s._v(" "),a("tr",[a("td",[s._v("root")]),s._v(" "),a("td",[s._v("应用根目录，"),a("code",[s._v("local")]),s._v(" 和 "),a("code",[s._v("unittest")]),s._v(" 环境下为 "),a("code",[s._v("baseDir")]),s._v("，其他都为 "),a("code",[s._v("HOME")]),s._v("。")])])])]),s._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("注意事项")]),s._v(" "),a("p",[a("strong",[s._v("值得注意的是："),a("code",[s._v("appInfo.root")]),s._v(" 是一个优雅的适配。")])]),s._v(" "),a("p",[s._v("比如在服务器环境我们会使用 "),a("code",[s._v("/home/admin/logs")]),s._v(" 作为日志目录，而本地开发时又不想污染用户目录，这样的适配就很好解决这个问题。")])]),s._v(" "),a("h2",{attrs:{id:"加载规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载规则","aria-hidden":"true"}},[s._v("#")]),s._v(" 加载规则")]),s._v(" "),a("p",[s._v("应用、插件、框架都可以定义这些配置，而且目录结构都是一致的。")]),s._v(" "),a("p",[s._v("但存在优先级（"),a("code",[s._v("应用 > 框架 > 插件")]),s._v("），相对于此运行环境的优先级会更高。")]),s._v(" "),a("p",[s._v("框架会按加载顺序使用 "),a("a",{attrs:{href:"https://github.com/eggjs/extend2",target:"_blank",rel:"noopener noreferrer"}},[s._v("extend2"),a("OutboundLink")],1),s._v(" 模块进行深度拷贝。")]),s._v(" "),a("p",[s._v("比如在 "),a("code",[s._v("prod")]),s._v(" 环境加载一个配置的加载顺序如下，后加载的会覆盖前面的同名配置。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 插件 config.default.js\n-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 框架 config.default.js\n-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 应用 config.default.js\n-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 插件 config.prod.js\n-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 框架 config.prod.js\n-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 应用 config.prod.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("注意事项")]),s._v(" "),a("p",[s._v("合并配置时，"),a("strong",[s._v("对于数组的处理是直接覆盖而不是合并。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("extend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// => { arr: [ 3 ] }")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("根据上面的例子，框架直接覆盖数组而不是进行合并。")])]),s._v(" "),a("h2",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题","aria-hidden":"true"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),a("h3",{attrs:{id:"为什么我的配置不生效？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么我的配置不生效？","aria-hidden":"true"}},[s._v("#")]),s._v(" 为什么我的配置不生效？")]),s._v(" "),a("p",[s._v("首先，要确保不会犯以下的低级错误：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// config/config.default.js")]),s._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("someKeys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'abc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("exports")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("appInfo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("其次，参考下一条 FAQ 来排查问题。")]),s._v(" "),a("h3",{attrs:{id:"如何查看最终的配置？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何查看最终的配置？","aria-hidden":"true"}},[s._v("#")]),s._v(" 如何查看最终的配置？")]),s._v(" "),a("p",[s._v("框架的配置功能比较强大，有不同环境变量，又有框架、插件、应用等很多地方配置。")]),s._v(" "),a("p",[s._v("如果你分析问题时，想知道当前运行时使用的最终配置，框架提供了：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("run/application_config.json")]),s._v(" 文件：最终的配置合并结果，可以用来分析问题。")]),s._v(" "),a("li",[a("code",[s._v("run/application_config_meta.json")]),s._v(" 文件：用来排查属性的来源。")])]),s._v(" "),a("p",[s._v("另外，基于安全的考虑，dump 出的文件中会对一些字段进行"),a("strong",[s._v("脱敏处理")]),s._v("，主要包括两类:")]),s._v(" "),a("ul",[a("li",[s._v("如密码、密钥等安全字段，可以通过 "),a("a",{attrs:{href:"https://github.com/eggjs/egg/blob/master/config/config.default.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("config.dump.ignore"),a("OutboundLink")],1),s._v(" 配置。")]),s._v(" "),a("li",[s._v("如函数、Buffer 等类型，"),a("code",[s._v("JSON.stringify")]),s._v(" 后的内容特别大。")])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("友情提示")]),s._v(" "),a("p",[s._v("注意："),a("code",[s._v("run")]),s._v(" 目录是每次启动期都会 dump 的信息，用于问题排查。")]),s._v(" "),a("p",[s._v("开发者修改该目录的文件将"),a("strong",[s._v("不会有任何效果")]),s._v("，应该把该目录加到 "),a("code",[s._v("gitignore")]),s._v(" 中。")])])])},[],!1,null,null,null);t.default=e.exports}}]);